<!doctype html>
<html class="no-js" lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>我的订单</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- all css here -->
    <!-- bootstrap v3.3.6 css -->
    <link rel="stylesheet" href="front-end/css/bootstrap.min.css">
    <!-- animate css -->
    <link rel="stylesheet" href="front-end/css/animate.css">
    <!-- jquery-ui.min css -->
    <link rel="stylesheet" href="front-end/css/jquery-ui.min.css">
    <!-- meanmenu css -->
    <link rel="stylesheet" href="front-end/css/meanmenu.min.css">
    <!-- nivo slider css -->
    <link rel="stylesheet" href="front-end/lib/css/nivo-slider.css" type="text/css" />
    <link rel="stylesheet" href="front-end/lib/css/preview.css" type="text/css" />
    <!-- owl.carousel css -->
    <link rel="stylesheet" href="front-end/css/owl.carousel.css">
    <!-- font-awesome css -->
    <link rel="stylesheet" href="front-end/css/font-awesome.min.css">
    <!-- style css -->
    <link rel="stylesheet" href="front-end/style.css">
    <!-- responsive css -->
    <link rel="stylesheet" href="front-end/css/responsive.css">
    <!-- modernizr js -->
    <script src="front-end/js/vendor/modernizr-2.8.3.min.js"></script>
    <link rel="stylesheet" href="layui/css/layui.css">
    <!--<script src="layer/layer.js"></script>-->
    <script src="layui/layui.js"></script>
</head>
<body>




<!--header top area start-->
<div th:replace="/common/front-end/header :: myheader"></div>
<!--header area end-->
<!-- mobile-menu-area-start -->
<div class="mobile-menu-area hidden-md hidden-lg">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="mobile-menu">
                    <nav id="mobile-menu-active">
                        <ul id="nav">
                            <li><a href="index.html">Home</a></li>
                            <li><a href="about-us.html">About</a></li>
                            <li><a href="cart.html">Cart</a></li>
                            <li><a href="list-view.html">List</a></li>
                            <li><a href="my.account.html">Account</a></li>
                            <li><a href="simple-product.html">Product</a></li>
                            <li><a href="contact-us.html">Contact us</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- mobile-menu-area-end -->
<!--social design arae start-->
<div th:replace="/common/front-end/link :: link"></div>
<!--social design arae end-->
<!-- comnt_area start -->
<div class="comnt_area" id="order">
    <div id="main">

        <!-- begin::main-content -->
        <main class="main-content">

            <div class="container">

                <div class="row">
                    <div class="col-md-12">

                        <div class="card">
                            <div class="card-body p-50">
                                <div class="invoice">
                                    <div class="d-md-flex justify-content-between align-items-center">
                                        <h2 class="font-weight-800 d-flex align-items-center">
                                            <img class="m-r-20" src="assets/media/image/logo-sm.png" alt="image">
                                        </h2>
                                        <h3 class="text-xs-left m-b-0">订单详情</h3>
                                    </div>
                                    <hr class="m-t-b-50">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <li><b>收货信息</b></li>
                                            <li>收货人：[[${session.loginUser.getNickName()}]]</li>
                                            <li>手机号：[[${session.loginUser.getPhone()}]]</li>
                                            <li>收货地址：[[${session.loginUser.getAddress()}]]</li>
                                        </div>
                                        <div class="col-md-6" style="text-align: end">
                                            <li class="text-right" style="margin-right: 15px"><b>订单状态</b></li>
                                            <li class="btn btn-default" id="nopay"><i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"></i>待支付 </li>
                                            <li class="btn btn-success" id="paysuccess" style="display: none"><i class="layui-icon layui-icon-ok-circle "></i>已支付 </li>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table mb-4 mt-4">
                                            <thead class="thead-light">
                                            <tr>
                                                <th>#</th>
                                                <th>商品名</th>
                                                <th class="text-right">数量</th>
                                                <th class="text-right">单价</th>
                                                <th class="text-right">小计</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr class="text-right" th:each="item,stat:${Items}">
                                                <td class="text-left" th:text="${stat.count}">1</td>
                                                <td class="text-left" th:text="${item.proName}">Brochure Design</td>
                                                <td th:text="${item.num}">2</td>
                                                <td th:text="${item.proPrice}">$20</td>
                                                <td th:text="${item.total}">$40</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="text-right">
                                        <p id="Subtotal">小计: $13,986</p>
                                        <p style="display: none">优惠 (10%) : $138</p>
                                        <h4 class="font-weight-800" id="Total">共计 : $12,348</h4>
                                    </div>
                                </div>
                                <div class="text-right d-print-none">
                                    <hr class="mb-5 mt-5">
                                    <a href="javascript:pay()" class="btn btn-primary">
                                        <i data-feather="send" class="mr-2"></i> 支付
                                    </a>
                                    <a href="javascript:printdiv()" class="btn btn-success m-l-5">
                                        <i data-feather="printer" class="mr-2"></i> 打印
                                    </a>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

            </div>

        </main>
        <!-- end::main-content -->

    </div>
</div>
<!-- comnt_area end -->
<!--newsletter area start-->
<div class="all_news_letter">
    <div class="news_letter">
        <div class="news_middele">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <div class="news_heading">
                            <h3> newsletter </h3>
                        </div>
                        <div class="full_form">
                            <form id="form-newsletter1" class="widget_wysija" method="post" action="#wysija">
                                <p class="wysija-paragraph">
                                    <input name="wysija[user][email]" class="wysija-input validate[required,custom[email]]" title="Enter Your Mail..." placeholder="Enter Your Mail..." value="" id="form-validation-field-0" style="" type="text">
                                </p>
                                <input class="wysija-submit wysija-submit-field" value="Subscribe!" type="submit">
                            </form>
                        </div>
                    </div>
                    <div class="col-md-6 col-xs-12">
                        <div class="dxpt_area">
                            <div class="news_right">
                                <div class="news_heading news_heading_3">
                                    <h3 class="follow_mix">Follow us:</h3>
                                </div>
                                <ul class="social-icons"  style="width:555px">
                                    <li>
                                        <a class="facebook social-icon" href="#facebook" title="" target="_blank" data-toggle="tooltip" data-original-title="Facebook">
                                            <i class="fa fa-facebook"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="twitter social-icon" href="#twitter.com" title="" target="_blank" data-toggle="tooltip" data-original-title="Twitter">
                                            <i class="fa fa-twitter"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="google-plus social-icon" href="#google-plus" title="" target="_blank" data-toggle="tooltip" data-original-title="Google-plus">
                                            <i class="fa fa-google-plus"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="youtube social-icon" href="#youtube" title="" target="_blank" data-toggle="tooltip" data-original-title="Youtube">
                                            <i class="fa fa-youtube"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="social-icon instagram" href="#" title="" target="_blank" data-toggle="tooltip" data-original-title="instagram">
                                            <i class="fa fa-instagram"></i>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--newsletter area end-->
<!--footer top area start-->
<div class="footer_area">
    <div class="container">
        <div class="row">
            <div class="col-md-3 col-sm-6">
                <div class="footer_menu">
                    <div class="news_heading_2">
                        <h3>Information </h3>
                    </div>
                    <div class="footer_menu">
                        <ul>
                            <li>
                                <a href="#">our blog</a>
                            </li>
                            <li>
                                <a href="#">about our shop</a>
                            </li>
                            <li>
                                <a href="#">secure shopping</a>
                            </li>
                            <li>
                                <a href="#">privecy policy</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="footer_menu">
                    <div class="news_heading_2">
                        <h3>My Account </h3>
                    </div>
                    <div class="footer_menu">
                        <ul>
                            <li>
                                <a href="#">My Account</a>
                            </li>
                            <li>
                                <a href="#">Wishlist</a>
                            </li>
                            <li>
                                <a href="#">Shopping Cart</a>
                            </li>
                            <li>
                                <a href="#">Checkout</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="footer_menu">
                    <div class="news_heading_2">
                        <h3> Our Services </h3>
                    </div>
                    <div class="footer_menu">
                        <ul>
                            <li>
                                <a href="#">Shipping & Returns</a>
                            </li>
                            <li>
                                <a href="#">Secure Shopping</a>
                            </li>
                            <li>
                                <a href="#">International Shipping</a>
                            </li>
                            <li>
                                <a href="#">Affiliates</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="footer_menu footer_menu_2">
                    <div class="news_heading_2">
                        <h3> Store Information </h3>
                    </div>
                    <ul>
                        <li>
                            <i class="fa fa-home"></i>
                            <p>My Company : 42 avenue des Champs Elysées 75000 France</p>
                        </li>
                        <li>
                            <i class="fa fa-phone"></i>
                            <p>Phone: (0123) 456789</p>
                        </li>
                        <li>
                            <i class="fa fa-envelope"></i>
                            <p>Email: admin@hastech.company</p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!--footer top area end-->
    <!--footer middle area start-->
    <div class="footer_middle">
        <div class="container">
            <div class="fotter_inner">
                <div class="middele_pic">
                    <img src="front-end/img/icon/payment-300x30.png" alt="" />
                </div>
            </div>
        </div>
    </div>
</div>
<!--footer middle area end-->
<!--footer bottom area start-->
<div class="footer-bottom">
    <div class="container">
        <div class="widget-copyright text-center">
            Copyright &copy; 2017.Company name All rights reserved.
        </div>
    </div>
</div>
<!--footer bottom area end-->






<!-- all js here -->
<!-- jquery latest version -->
<script src="front-end/js/vendor/jquery-1.12.0.min.js"></script>
<!-- bootstrap js -->
<script src="front-end/js/bootstrap.min.js"></script>
<!-- nivo slider js -->
<script src="front-end/lib/js/jquery.nivo.slider.js" type="text/javascript"></script>
<script src="front-end/lib/home.js" type="text/javascript"></script>
<!-- owl.carousel js -->
<script src="front-end/js/owl.carousel.min.js"></script>
<!-- meanmenu js -->
<script src="front-end/js/jquery.meanmenu.js"></script>
<!-- jquery-ui js -->
<script src="front-end/js/jquery-ui.min.js"></script>
<!-- easing js -->
<script src="front-end/js/jquery.easing.1.3.js"></script>
<!-- mixitup js -->
<script src="front-end/js/jquery.mixitup.min.js"></script>
<!-- jquery.countdown js -->
<script src="front-end/js/jquery.countdown.min.js"></script>
<!-- wow js -->
<script src="front-end/js/wow.min.js"></script>
<!-- popup js -->
<script src="front-end/js/jquery.magnific-popup.min.js"></script>
<!-- plugins js -->
<script src="front-end/js/plugins.js"></script>
<!-- main js -->
<script src="front-end/js/main.js"></script>
</body>

<script type="text/javascript" th:inline="javascript">
    window.onload=function () {
        var status =[[${order.status}]];
        if(status){
            $('#paysuccess').attr({style:""})
            $('#nopay').attr({style: "display: none"})
        }
    }

    layui.use(['layer', 'form'], function(){
        var layer = layui.layer;
    });
    //页面加载时，获取所有数据
    var list = [[${Items}]];
    getTotal(list);
    var payAmount;
    function getTotal(list){
        var total = 0;
        $.each(list, function (index, node) {
            total += parseInt(node.total);
        });
        payAmount=total;
        $('#Subtotal').text("小计:￥" + total);
        $('#Total').text("共计:￥" + total);
    }
    function pay(){

        $.ajax({
            url:'/pay',
            type:'post',
            contentType:'application/json',
            data:JSON.stringify({
                "id":[[${order.id}]],
                "payAmount":payAmount
            }),
            success:function (res) {
                if(res=="支付成功"){
                    $('#paysuccess').attr({style:""})
                    $('#nopay').attr({style: "display: none"})
                    layer.msg(res, {icon: 1, time: 1000})
                }else {
                    layer.msg(res, {icon: 2, time: 1000})
                }
            }
        })
    }
</script>
<script>
    var oldstr = document.body.innerHTML;
    $(function () {
        var beforePrint = function() {
            console.log('Functionality to run before printing.');
        };

        var afterPrint = function() {
            console.log('Functionality to run after printing');
        };

        if (window.matchMedia) {
            var mediaQueryList = window.matchMedia('print');
            mediaQueryList.addListener(function(mql) {
                if (mql.matches) {
                    beforePrint();
                } else {
                    afterPrint();
                    document.body.innerHTML = oldstr;
                }
            });
        }

        window.onbeforeprint = beforePrint;
        window.onafterprint = afterPrint;
    });

    function printdiv() {
        var headstr = '<html><head><title>订单详情</title></head><body>';
        var footstr = "</body></html>";
        var newstr = document.getElementById('order').innerHTML;
        document.body.innerHTML = headstr + newstr + footstr;
        console.log(headstr + newstr + footstr)
        window.print();
        return false;
    }
</script>
</html>

